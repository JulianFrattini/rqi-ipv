---
title: "Frequentist Analysis of the Impact of Passive Voice"
author: "Julian Frattini"
date: '2023-11-29'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(tidyverse)

library(rcompanion)
library(psych)
```

This document contains the frequentist analysis performed by Femmer et al.^[Femmer, H., Kučera, J., & Vetrò, A. (2014, September). On the impact of passive voice requirements on domain modelling. In Proceedings of the 8th ACM/IEEE International Symposium on Empirical Software Engineering and Measurement (pp. 1-4).].

## Data Loading

We start by loading the data which is disclosed at https://doi.org/10.5281/zenodo.7499290.

```{r data-load}
participants <- read.csv(file="../data/participants.csv")
experience <- read.csv(file="../data/experience.csv")
requirements <- read.csv(file="../data/requirements.csv")
responses <- read.csv(file="../data/responses.csv")
```

Join the three separate tables and rename some columns.

```{r data-join}
d <- responses %>% 
  full_join(participants) %>% # add information about the participants
  full_join(experience) %>% # add information about the participants' experience
  full_join(requirements) %>% # get information about the expected actors etc. of the requirement
  mutate(
    passive = if_else(startsWith(PID, 'P'), TRUE, FALSE), # introduce a factor variable for passive voice

    actors.missing = if_else(MAct > EAct, EAct, MAct), # cutoff missing actors by expected actors
    actors.found = EAct-actors.missing, # inverse missed to found actors
    actors.expected = EAct, # spell out the variable
  
    associations.missing = if_else(MAsc > EAsc, EAsc, MAsc),
    associations.found = EAsc-associations.missing,
    associations.expected = EAsc,
    
    entities.missing = if_else(MEnt > EEnt, EEnt, MEnt),
    entities.found = EEnt-entities.missing,
    entities.expected = EEnt,
    
    REQuizPerformance = RExp)
  # ) %>% 
  # select(
  #   PID, RID, 
  #   Age, Program, REQuizPerformance, 
  #   ExpProgAca, ExpProgInd, ExpSEAca, ExpSEInd, ExpREAca, ExpREInd, 
  #   passive, 
  #   actors.expected, actors.found, actors.missing, 
  #   associations.expected, associations.found, associations.missing,
  #   entities.expected, entities.found, entities.missing)
```

Cast categorical variables as such. The age, program, and all experience variables are categorical (and ordered). Hence, we flag them as such in the data set.

```{r data-factors}
cat_age <- c("19-24", "25-30", "31-40")
cat_exp <- c("no experience", "up to 6 months", "6 to 12 months", "more than 12 months")
cat_prg <- c("Unknown", "Bachelor", "Master", "Doctorate")


d$Age <- factor(d$Age, levels=cat_age, ordered=TRUE)

d$ExpProgAca <- factor(d$ExpProgAca, levels=cat_exp, ordered=TRUE)
d$ExpProgInd <- factor(d$ExpProgInd, levels=cat_exp, ordered=TRUE)
d$ExpSEAca <- factor(d$ExpSEAca, levels=cat_exp, ordered=TRUE)
d$ExpSEInd <- factor(d$ExpSEInd, levels=cat_exp, ordered=TRUE)
d$ExpREAca <- factor(d$ExpREAca, levels=cat_exp, ordered=TRUE)
d$ExpREInd <- factor(d$ExpREInd, levels=cat_exp, ordered=TRUE)

d$Program <- factor(d$Program, levels=cat_prg, ordered=TRUE)
```

Finally, visualize the variables of the data set to confirm that all looks correct.

```{r data-view}
str(d)
```

## Frequentist Analysis

Next, we perform a frequentist analysis. We begin by suming the number of missing actors, associations, and entities per participant.

```{r sum}
d.pid <- d %>% 
  group_by(PID) %>% 
  summarize(
    MAct = sum(MAct),
    MEnt = sum(MEnt),
    MAsc = sum(MAsc)
  ) %>% mutate(
    passive = if_else(startsWith(PID, 'P'), 1, 0)
  )
```

We display the mean and median of one of the variables to confirm that they are similar to what is reported in the paper by Femmer et al.

```{r display-mean-median}
d.pid %>% 
  group_by(passive) %>% 
  summarize(
    Mean = mean(MEnt, na.rm=TRUE),
    Median = median(MEnt, na.rm=TRUE)
  )
```

Additionally, plot the distributions as box plots.

```{r display-distribution}
d.pid %>% 
  ggplot(aes(x=as.factor(passive), y=MAsc)) +
  geom_boxplot()
```

Finally, perform a Mann-Whitney U test (i.e., a two-sample Wilcoxon test).

```{r hypothesis-test}
wilcox.test(x = filter(d.pid, passive==1)$MAsc,
            y = filter(d.pid, passive==0)$MAsc,
            conf.int = TRUE,
            paired = FALSE)
```

